// ------------------------------------------------------
// ğŸ“Œ PROMISE BASICS
// Promise â†’ async (asynchronous) operations handle panna use agum
// Example: Server call, Database fetch, setTimeout() etc.
// States â†’ 3 types
//   1. Pending  â†’ Start aagum (waiting stage)
//   2. Fulfilled (Resolved) â†’ Success aana case, data return agum
//   3. Rejected â†’ Fail aana case la, error message return agum
// ------------------------------------------------------

const promise = new Promise((resolve, reject) => {
    setTimeout(() => {
        resolve("âœ… Task Completed!");  // success case
        // reject("âŒ Task Failed!");   // failure case
    }, 2000);
});

// promise resolve aana result handle panna â†’ .then()
// promise reject aana error handle panna â†’ .catch()
promise
    .then((res) => console.log("Result:", res))
    .catch((err) => console.log("Error:", err));


// ------------------------------------------------------
// ğŸ“Œ REAL LIFE PROMISE EXAMPLE (Fake API)
// ------------------------------------------------------
function getUsersPromise() {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            let users = [
                { username: "john", email: "john@test.com" },
                { username: "jane", email: "jane@test.com" },
            ];
            resolve(users); // success case
        }, 1500);
    });
}

getUsersPromise()
    .then((users) => console.log("All Users (Promise):", users))
    .catch((err) => console.log("Error:", err));


// ------------------------------------------------------
// ğŸ“Œ PROMISE PROBLEM
// Nested .then() calls â†’ "callback hell" à®ªà¯‹à®² messy à®†à®•à¯à®®à¯
// à®…à®¤à®©à®¾à®² Async/Await à®µà®¨à¯à®¤à¯à®šà¯à®šà¯
// ------------------------------------------------------


// ------------------------------------------------------
// ğŸ“Œ ASYNC / AWAIT BASICS
// async function â†’ eppovum promise return pannum
// await â†’ promise complete aana varaikum wait pannum
// ------------------------------------------------------

function delayTask() {
    return new Promise((resolve) => {
        setTimeout(() => resolve("âœ… Delay Task Completed"), 1000);
    });
}

async function runTask() {
    console.log("Task Starting...");
    let result = await delayTask(); // wait until promise resolves
    console.log(result);
    console.log("Task Finished!");
}
runTask();


// ------------------------------------------------------
// ğŸ“Œ REAL LIFE EXAMPLE with ASYNC/AWAIT
// Same getUsers but await use pannuvom
// ------------------------------------------------------

async function getUsersAsync() {
    console.log("Fetching Users with async/await...");
    const users = await getUsersPromise(); // wait for promise
    console.log("All Users (Async/Await):", users);
}
getUsersAsync();


// ------------------------------------------------------
// ğŸ“Œ FIND SPECIFIC USER with ASYNC/AWAIT
// ------------------------------------------------------

async function findUser(username) {
    const users = await getUsersPromise(); // wait users
    return users.find((user) => user.username === username);
}

(async function () {
    const user = await findUser("jane");
    console.log("Found User:", user);
})();


// ------------------------------------------------------
// ğŸ“Œ ERROR HANDLING in ASYNC/AWAIT
// try/catch use panna â†’ reject case handle panna mudiyum
// ------------------------------------------------------

function getData(fail = false) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            if (fail) reject("âŒ Something went wrong!");
            else resolve("âœ… Data Fetched Successfully");
        }, 1000);
    });
}

async function fetchData() {
    try {
        const result = await getData(true); // true â†’ force error
        console.log(result);
    } catch (err) {
        console.log("Error Caught:", err);
    } finally {
        console.log("Finally block always runs âœ…");
    }
}
fetchData();


// ------------------------------------------------------
// ğŸ“Œ PROMISE vs ASYNC/AWAIT â€“ SUMMARY
// ------------------------------------------------------
/*
ğŸ‘‰ Promise
   - .then() â†’ success handle
   - .catch() â†’ error handle
   - downside: nested .then() messy code

ğŸ‘‰ Async/Await
   - async keyword â†’ function promise return pannum
   - await keyword â†’ promise resolve varaikum wait
   - try/catch â†’ error handle easy
   - code readable, synchronous maari irukkum

âœ… Real-world apps (API calls, DB queries) la mostly Async/Await prefer pannuvanga.
*/
